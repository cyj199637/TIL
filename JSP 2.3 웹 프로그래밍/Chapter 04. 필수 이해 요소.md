# Chapter 04. 필수 이해 요소

## 01. JSP 처리 과정

WAS는 JSP 페이지에 대한 요청이 들어오면 다음과 같이 처리한다.

![img](../images/1464B1474E65A0C01F)

* JSP에 해당하는 서블릿이 존재하지 않을 경우: 1.1 → 1.2(변환 단계) → 1.3(컴파일 단계) → 2.1 → 2.2 → 응답 전송
* JSP에 해당하는 서블릿이 존재하는 경우: 2.1 → 2.2 → 응답 전송

즉, JSP 페이지를 요청할 때는 JSP를 직접 실행하는 것이 아니라, **JSP를 자바 소스 코드로 변환한 뒤 컴파일해서 생성한 서블릿을 실행하는 것**이다. JSP 페이지를 변경하면 서블릿 클래스를 다시 생성한다.





## 02. 출력 버퍼와 응답

JSP 페이지는 응답 결과를 곱바로 웹 브라우저에 전송하지 않는다. 대신 출력 버퍼에 임시로 응답 결과를 저장했다가 버퍼에 보관된 데이터가 일정 크기가 되면 한 번에 웹 브라우저에 전송한다.

![img](../images/1353AB364E65A34B22)

#### 장점

* 데이터 전송 성능 향상: 한 번에 큰 단위로 데이터 전송 가능

* JSP 실행 도중 버퍼를 비우고 새로운 내용 전송 가능

  : JSP 실행 과정에서 에러가 발생하면 지금까지 생성한 내용을 버퍼에서 지우고 에러 화면을 출력할 수 있음

* 버퍼가 다 차기 전까지 헤더 변경 가능



### 버퍼 동작 방식

![img](../images/254C2D4756D8E0F125)

* 플러시: 버퍼가 다 찾을 때 버퍼에 쌓인 데이터를 실제로 전송되어야 할 곳에 전송하고 버퍼를 비우는 것
* 버퍼에 보관된 응답 데이터를 전송하기 전에 응답 상태 코드와 응답 헤더를 먼저 전송





## 03. 웹 어플리케이션 폴더 구성과 URL 매핑

### 웹 어플리케이션 기본 폴더 구조

![img](../images/2657764D56D8E14212)

* `[톰캣]\webapps\웹어플리케이션` : 웹 어플리케이션이 위치
  * `WEB-INF` : 웹 어플리케이션 설정 정보를 담고 있는 web.xml이 위치
    * `WEB-INF/classes` : 웹 어플리케이션에서 사용하는 클래스 파일 위치
    * `WEB-INF/lib` : 웹 어플리케이션에서 사용하는 jar 파일 위치



### 3.1 웹 어플리케이션 폴더와 URL의 관계

* `[톰캣]\webapps\웹경로` → `http://host:port[/웹경로]`
* `\webapps\ROOT` : 루트 웹 어플리케이션을 위한 특수 폴더 → `http://host:port`
  * URL의 첫 번째 경로와 일치하는 컨텍스트 경로를 가진 웹 어플리케이션이 존재하지 않으면 루트 웹 어플리케이션이 요청을 처리
  * 컨텍스트 경로: `http://localhost:8080/view/helloWorld.jsp` 의 컨텍스트 경로는 `/view`





## 04. 웹 어플리케이션 배포

### 4.1 대상 폴더에 파일을 직접 복사

`[톰캣]\webapps` 폴더에 웹 어플리케이션 폴더를 복사



### 4.2 톰캣에 war 파일로 묶어서 배포

#### war

: 웹 어플리케이션의 구성 요소를 하나로 묶어 놓은 파일

JDK의 jar 명령어를 사용하여 war 파일 생성한 후, `[톰캣]\webapps` 폴더에 복사

`jar cvf chap04.war *`

* c: 새로운 파일을 생성함
* v: 세부 정보를 콘솔에 표시함
* f: 셍상힐 핑;ㄹㅇ,; ㅇ;ㄹ,ㅁㅇ,ㄹ ㅈ;장힘
* `*` : 현재 폴더의 모든 파일과 하위 폴더가 대상이라는 뜻 