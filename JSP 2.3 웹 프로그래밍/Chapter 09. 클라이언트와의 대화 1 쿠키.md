# Chapter 09. 클라이언트와의 대화 1: 쿠키

웹 서버는 쿠키를 이용해서 웹 브라우저에 정보를 전송할 수 있다. 웹 서버로부터 쿠키를 전달받은 웹 브라우저는 이후 웹 서버에 요청을 보낼 때 쿠키를 함께 전송한다. 이를 사용하면 웹 서버와 웹 브라우저는 필요한 값을 공유하고 상태를 유지할 수 있다.

## 01. 쿠키 사용하기

#### 쿠키

: 웹 브라우저가 보관하는 데이터

* 웹 브라우저는 웹 서버에 요청을 보낼 때 쿠키를 함께 전송
* 웹 서버는 웹 브라우저가 전송한 쿠키를 사용해서 필요한 데이터를 읽을 수 있음
* JSP 프로그래밍에서는 웹 서버 측에서 쿠키 생성

### 쿠키 동작 방식

![image-20210206020648929](../images/image-20210206020648929.png)

1. 쿠키 생성 단계: 쿠키를 생성한 후, 응답 데이터의 헤더에 저장해서 웹 브라우저에 전송
   * 쿠키 값으로 사용할 수 있는 문자가 한정되어 있기 때문에 적절한 방식으로 인코딩해야 함
   * 응답 데이터의 SET-COOKIE 헤더를 통해 전달됨
     * 따라서 출력 버퍼를 플러시하기 전에 추가해야 함
2. 쿠키 저장 단계: 웹 브라우저는 쿠키를 쿠키 저장소에 보관
3. 쿠키 전송 단계: 웹 브라우저는 저장한 쿠키를 요청이 있을 때마다 요청 헤더에 저장하여 웹 서버에 전송
   * 쿠키가 삭제되기 전까지 웹 서버에 쿠키 전송하므로 웹 어플리케이션을 사용하는 동안 지속적으로 유지해야 하는 정보를 쿠키에 저장하면 됨
   * 웹 서버는 전달받은 쿠키로 필요한 작업 수행



### 1.1. 쿠키의 구성

* 이름
* 값
* 유효시간: 쿠키의 유지 시간
  * 웹 브라우저가 쿠키를 얼마동안 보관할지 지정
* 도메인: 웹 브라우저에서 쿠키를 전송할 도메인
* 경로: 웹 브라우저에서 쿠키를 전송할 요청 경로



### 1.5 쿠키의 도메인

기본적으로 쿠키는 해당 쿠키를 생성한 서버에만 전송된다. 하지만 같은 도메인을 사용하는 모든 서버에 쿠키를 보내고 싶다면 도메인 설정으로 쿠키를 공유할 도메인을 지정할 수 있다. 

* 도메인으로 지정할 수 있는 값은 현재 서버의 도메인이나 상위 도메인 뿐이다. 그 외의 도메인을 지정한다면 웹 브라우저는 쿠키를 저장하지 않는다.

  ex) 현재 서버 주소 = mail.somehost.com

  ​	  도메인으로 줄 수 있는 값 = mail.somehost.com / .somehost.com



### 1.6 쿠키의 경로

경로는 쿠키를 공유할 기준 경로를 지정한다. 쿠키의 경로를 지정하면, 웹 브라우저는 지정한 경로나 하위 경로에 대해서만 쿠키를 전송한다. 

* 경로: URL에서 도메인 이후의 부분

* 따로 지정하지 않으면 실행한 URL의 경로 부분을 사용



### 1.7 쿠키의 유효시간

* 따로 지정하지 않으면 웹 브라우저를 종료할 때 쿠키를 함께 삭제
  * 웹 브라우저를 다시 실행해도 삭제한 쿠키는 서버에 전송되지 않음
* 유효시간을 정하면 웹 브라우저를 종료해도 유효시간이 지나지 않으면 쿠키를 삭제하지 않음