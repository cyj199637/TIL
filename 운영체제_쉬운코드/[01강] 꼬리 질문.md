## 1. 프로세스 간 컨텍스트 스위칭은 어떻게 일어나는가?

인터럽트 이벤트가 발생하면 컨텍스트 스위칭이 일어나게 된다.

- 인터럽트 이벤트 예시
    - 자식 프로세스 생성
    - CPU 시간이 경과하는 것
        - 프로세스가 어떤 프로그램을 수행 중이더라도 타임 슬라이스를 모두 소비하면 발생한다.
    - 키보드나 마우스 같은 사용자 입력
    - HDD나 SSD 같은 저장 장치의 읽고 쓰기의 종료
    - 네트워크 데이터 송수신의 종료

<br/>

컨텍스트 스위칭을 하려면 현재 실행 중인 프로세스의 정보를 저장해야 하는데 이때 사용하는 자료구조가 PCB다.

- PCB
    - 특정 프로세스에 대한 정보를 담고 있는 자료구조
    - 프로세스가 생성될 때마다 고유의 PCB가 생성되고 프로세스가 완료되면 제거된다.

<br/>

![Untitled](./image/img_07.png)

- 컨텍스트 스위칭 시나리오
    1. 인터럽트 이벤트가 발생하여 PCB0에 P0 프로세스의 상태 정보를 저장
    2. PCB1에서 다음 수행할 P1 프로세스의 상태 정보가 CPU에 재로딩
    3. P1 프로세스를 CPU 시간만큼 수행
    4. 인터럽트 이벤트가 발생하여 PCB1에 P1 프로세스의 상태 정보를 저장
    5. 반복

<br/>

컨텍스트 스위칭은 프로세스 상태에 기인한다.

그 중 준비 상태, 실행 상태, 대기 상태에 해당하는 프로세스들을 번갈아가면서 지속적으로 실행한다.

![Untitled](./image/img_08.png)

- Ready: CPU 시간이 할당되기를 기다리고 있는 상태
- Running: 현재 CPU를 사용하고 있는 상태
- Blocked: 인터럽트 이벤트가 발생하기를 기다리고 있으며 이벤트 발생까지는 CPU 시간을 사용하지 않는다.

<br/>

### 1.1 프로세스는 언제 생성되는가?

리눅스에서는 두 가지 목적으로 프로세스를 생성한다.

1. 같은 프로그램의 처리를 여러 개의 프로세스가 나눠서 처리할 때 → fork() 함수 사용
    - 실행한 프로세스와 함께 새로운 프로세스가 1개 생성된다.

      → 자식 프로세스용 메모리 영역을 작성하고 해당 영역에 부모 프로세스의 메모리를 복사

2. 전혀 다른 프로그램을 생성할 때 → execve() 함수 사용
    - 프로세스의 수가 증가하는 것이 아니라 기존의 프로세스를 별도의 프로세스로 변경

      → 현재 프로세스의 메모리를 새로운 프로세스의 데이터로 덮어씀

<br/>

### 1.2 프로세스 간 데이터 공유는 어떻게 일어나는가?

원칙적으로 프로세스는 독립적인 주소 공간을 갖기 때문에, 다른 프로세스의 주소 공간을 참조할 수 없다.

하지만 경우에 따라 운영체제는 프로세스 간의 자원 접근을 위한 매커니즘인 프로세스 간 통신(IPC)를 제공한다.

프로세스 간 통신 방법으로는 대표적으로 두 가지 방식이 있다.

- 메시지 전달 모델
    - 커널을 통해 프로세스 간 데이터를 전송하는 방식
        - ex) Pipe, socket, message queue 등
    - 프로세스 동기화 과정을 커널에 위임하여 자동으로 처리하게 한다. → 높은 안정성
    - 커널에 모든 작업이 위임되어 OS가 감당하는 오버헤드가 커지고 속도가 느리다.
- 공유 메모리 모델
    - 프로세스 간 공유할 수 있는 메모리 영역을 지정하고, 공유한 메모리 영역에 통신하며 데이터를 간접적으로 전달하는 방식
    - 운영체제를 통해 통신하는 것이 아니기 때문에 속도는 빠르다.
    - 여러 프로세스가 접근할 수 있기 때문에 별도의 프로세스 동기화 과정을 직접 정의해주어야 한다.

      → 동기화 문제가 발생할 수 있음

<br/><br/>

## 2. 스레드 간 컨텍스트 스위칭은 어떻게 일어나는가?

### 2.1 스레드 간 데이터 공유는 어떻게 일어나는가?

<br/>

### 2.2 스레드 간 스택 영역을 공유하지 않는 이유는 무엇인가?

스택 영역에는 함수의 호출과 관계되는 지역 변수와 매개변수가 저장되는 영역이다.

만약 이 영역을 공유한다면 스레드 간 독립적인 함수 호출이 불가능해지며 이는 스레드 간 독립적인 실행 흐름을 가질 수 없다는 것을 의미 한다.

결과적으로 실행 흐름의 추가를 위한 최소 조건이 독립된 스택을 제공하는 것이다.

<br/><br/>

### 3. 컨텍스트 스위칭은 누가 어떻게 관리하는가?