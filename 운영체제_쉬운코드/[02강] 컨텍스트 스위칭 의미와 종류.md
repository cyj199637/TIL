# [02강] 컨텍스트 스위칭 의미와 종류
(강의 자료 링크: https://www.youtube.com/watch?v=Xh9Nt7y07FE)

## 컨텍스트 스위칭은 무엇인가?

### 컨텍스트 스위칭

CPU/코어에서 실행 중이던 프로세스/스레드가 다른 프로세스/스레드로 교체되는 것

오늘날의 컴퓨터에서는 하나의 프로세스는 하나의 스레드를 가진다.

스레드가 CPU/코어의 기본 단위기 때문

그래서 프로세스에서 프로세스로 교체다는 말은 사실 어떤 프로세스 안에 실행되는 스레드가 다른 프로세스 안에 실행되는 스레드로 바뀐다는 말이다.

<br/>

### 컨텍스트

프로세스/스레드의 상태

- 여기서 상태는 CPU나 메모리에서의 상태를 의미한다.

<br/>

cf) CPU 레지스터

<br/><br/>

## 컨텍스트 스위칭은 왜 필요한가?

→ 여러 프로세스/스레드를 동시에 실행시키기 위해서

<br/><br/>

## 컨텍스트 스위칭은 언제 발생하는가?

- 주어진 타임 슬라이스를 다 사용했거나
- IO 작업을 해야하거나
- 다른 프로세스나 스레드에서 사용하고 있는 리소스를 기다려야 하거나
- 인터럽트가 걸렸거나
- …

<br/><br/>

## 컨텍스트 스위칭은 누구에 의해 실행되는가?

→ OS 커널

- 각종 리소스를 관리/감독하는 역할
- 컨텍스트 스위칭을 총괄해서 통제권을 가지고 집행/수행하는 존재

  (컨텍스트 스위칭의 발생 트리거가 아님)


- 커널
    - CPU, 메모리 등 컴퓨터에 존재하는 다양한 리소스들을 관리/감독

<br/><br/>

## 컨텍스트 스위칭은 구체적으로 어떤 과정으로 일어나는가?

다른 프로세스끼리 스위칭(프로세스 컨텍스트 스위칭)인지 같은 프로세스의 스레드들끼리 스위칭(스레드 컨텍스트 스위칭)인지에 따라 다르다.

<br/>

### 공통점

1. 커널 모드에서 실행

   → 현재 실행되고 있는 프로세스/스레드의 CPU 상태를 저장하고, 다음 프로세스/스레드의 CPU 상태를 로딩하기 위해

    - 커널 모드
        - OS 커널로 통제권이 넘어가서 커널에 실행되는 상황
        - ex) 프로세스가 하드웨어 등의 컴퓨터의 리소스를 다뤄야 할 때 리소스에 직접 접근하지 않고 OS 커널을 통해 접근을 하게 됨
2. CPU의 레지스터 상태를 교체

   → 현재 실행되고 있는 프로세스/스레드도 다음 자기 차례가 왔을 때 현재 작업을 이어서 해야 되기 때문에 컨텍스트 스위칭 직전에 실행되고 있던 프로세스/스레드의 레지스터 상태 정보를 저장해야 함

    - 레지스터
        - 각종 명령어를 수행하기 위한 필요한 데이터를 저장하는 역할

<br/>

### 차이점

프로세스 컨텍스트 스위칭은 가상 메모리 주소 관련 처리를 추가로 수행

- MMU를 새로운 프로세스의 메모리 주소를 바라보게 수정 해야 함
    - MMU
- TLB도 완전히 비워줘야 함
    - TLB: 가상 메모리 주소와 실제 물리 메모리 주소의 매핑 정보를 저장

만약 수행하지 않으면 컨텍스트 스위칭 이전의 프로세스의 메모리 영역으로 잘못 접근하게 될 수도 있음

<br/><br/>

## 스레드 컨텍스트 스위칭이 더 빠른 이유

→ 같은 메모리 공간을 공유하기 때문에 메모리 주소 관련 처리는 하지 않기 때문

- CPU 상태 정보만 교체하면 됨

<br/><br/>

## 컨텍스트 스위칭이 미치는 영향

### 캐시 오염

- 컨텍스트 스위칭 직후에 실행되는 프로세스/스레드의 경우에는 필요한 데이터가 캐시에 없음

  → 필요한 데이터를 얻기 위해 메모리까지 가게 되면서 처리 성능 및 속도가 떨어지게 됨

    - 캐시에는 컨텍스트 스위칭 이전에 실행된 프로세스/스레드에서 사용했던 데이터들이 있음
- 프로세스 컨텍스트 스위칭에서 더 자주 발생
    - 같은 프로세스 내 스레드들끼리는 같은 메모리 영역을 공유하기 때문에 덜 영향을 받음

<br/><br/>

## 유저 관점에서 컨텍스트 스위칭이란?

→ 컨텍스트 스위칭은 순수한 오버헤드다

따라서, 컨텍스트 스위칭이 많이 발생할수록 유저가 실행한 프로그램의 동작과 전혀 관계 없는 간접 비용만 증가하게 된다.