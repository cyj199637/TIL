# Chapter06. 라우팅
## 6-1 라우팅: 외부 네트워크로 데이터를 보낸다

이더넷과 무선 LAN으로 같은 네트워크 안에서 데이터를 전송할 수 있다.

그러나 다른 네트워크에 데이터를 보내려면 네트워크를 서로 연결하는 라우터로 전송해야 한다.

<br/>

### 라우팅

> 연결된 네트워크의 라우터로 데이터를 전송하는 것

- 라우터는 데이터의 목적지가 어느 네트워크에 접속해 있는지 판단하고, 다음 라우터(= 넥스트 홉)로 데이터를 전송한다.

  → 라우팅을 반복하면 멀리 떨어진 네트워크에도 데이터를 전송할 수 있다.

- 라우터의 전송 대상 데이터는 IP 패킷

  → IP 패킷은 인터넷층에 속하므로 라우팅도 인터넷층에서 일어난다.

- 라우터가 IP 패킷을 전송할 때는 IP 헤더 안에 목적지 IP 주소를 확인한다.
- IP 헤더의 TTL과 헤더 체크섬만 변경된 채로 전송된다.
    - NAT 주소 변환이 이루어질 때는 IP 주소도 변경된다.
    - 이더넷 헤더 등 네트워크 인터페이스층 프로토콜 헤더는 라우터가 전송할 때 완전히 새로운 헤더로 교체된다.

      → 다른 라우터까지 보내기 위해 필요한 정보기 때문

<br/><br/>

## 6-2 네트워크의 연결: 라우터에서 네트워크 연결에 필요한 주소 설정

라우터로 네트워크에 접속하기 위해서는 라우터 인터페이스에 물리적인 배선을 하고, IP 주소를 설정해야 한다.

라우터에 여러 개의 인터페이스가 준비되어 있으므로, 물리적인 배선과 IP 주소 설정을 각각 할 필요가 있다.

<br/><br/>

## 6-3~6 라우터의 데이터 전송 흐름

(호스트1 ↔ 라우터1) ↔ (라우터2 ↔ 호스트2) 구성에서 호스트1 → 호스트2 로 데이터를 전송한다고 했을 때

1. 라우팅 대상인 IP 패킷을 수신한다
    - (호스트1 → 라우터1) 의 IP 패킷 정보
        - 목적지 레이어2 주소(MAC 주소): 라우터1의 MAC 주소
        - 목적지 IP 주소: 호스트2의 IP 주소

<br/>

2. 경로 정보를 검색해서 전송할 곳을 결정한다

   → 목적지 IP 주소로 라우팅 테이블 상의 경로 정보를 검색해 전송할 곳을 결정

    - 라우터1은 목적지 IP 주소와 일치하는 라우팅 테이블의 경로 정보를 검색
        - 라우터2를 넥스트 홉으로 지정

<br/>

3. 레이어2 헤더를 수정해 IP 패킷을 전송한다.
    - 라우터1과 라우터2는 이더넷으로 연결된 네트워크 구성이기 때문에 라우터2로 전송하기 위해서는 이더넷 헤더를 추가해야 한다.

      → 라우터2의 MAC 주소 필요

    - ARP를 실행하여 라우터2의 MAC 주소를 알아낸다.

      → 새로운 이더넷 헤더로 바꾼 후(+ FCS 추가) IP 패킷을 라우터2로 전송

    - IP 헤더의 IP 주소는 달라지지 않지만 TTL을 -1하고, 헤더 체크섬을 다시 계산한다.
    - (라우터1 → 라우터2) 의 IP 패킷 정보
        - 목적지 레이어2 주소(MAC 주소): 라우터1과 연결된 라우터2 인터페이스 주소
        - 목적지 IP 주소: 호스트2의 IP 주소

<br/>

4. 라우터2에서도 라우팅1처럼 처리를 한다.
    - 라우터2도 라우팅 테이블에서 목적지 IP 주소와 일치하는 경로 정보를 탐색한다.

      → 호스트2가 같은 네트워크 내에 있는 것을 확인

<br/>

5. 라우터2 → 호스트2로 전송한다.
    - 호스트2로 IP 패킷을 전송하기 위해 ARP를 실행하여 호스트2의 MAC 주소를 알아낸다.

      → 새로운 이더넷 헤더로 바꾼 후 IP 패킷을 호스트2로 전송

<br/>

6. 요청이 전송된 방향과 반대 방향으로 응답을 전송한다.